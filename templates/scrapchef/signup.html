{% extends "scrapchef/base.html" %}

{% block content %}
<div class="signup-container">
    <h1 class="logo">Join <span>Scrap Chef</span></h1>
    <p class="tagline">Let's make meals better together!</p>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
            <p class="message {{ message.tags }}">{{ message }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" class="signup-form">
        {% csrf_token %}

        <div class="input-group">
            <label for="username">Username:</label>
            <input type="text" name="username" id="username" required>
            <p class="instructions-box" id="username-instructions">Must be 6-20 characters long.</p>
        </div>

        <div class="input-group">
            <label for="password">Password:</label>
            <input type="password" name="password" id="password" required>
            <p class="instructions-box" id="password-instructions">At least 8 characters with letters & numbers.</p>
        </div>

        <div class="input-group">
            <label for="occupation">Occupation (Optional):</label>
            <input type="text" name="occupation" id="occupation">
        </div>

        <div class="input-group">
            <label for="profile_photo">Profile Photo (Optional):</label>
            <input type="file" name="profile_photo" id="profile_photo">
        </div>

        <button type="submit" class="signup-btn">Sign Up</button>
    </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Show instructions on focus
        const usernameInput = document.getElementById("username");
        const passwordInput = document.getElementById("password");
        const usernameInstructions = document.getElementById("username-instructions");
        const passwordInstructions = document.getElementById("password-instructions");

        function toggleInstructions(input, instruction, show) {
            instruction.style.display = show ? "block" : "none";
        }

        usernameInput.addEventListener("focus", () => toggleInstructions(usernameInput, usernameInstructions, true));
        usernameInput.addEventListener("blur", () => toggleInstructions(usernameInput, usernameInstructions, false));

        passwordInput.addEventListener("focus", () => toggleInstructions(passwordInput, passwordInstructions, true));
        passwordInput.addEventListener("blur", () => toggleInstructions(passwordInput, passwordInstructions, false));

        // ✅ Detect success message and handle redirect
        const successMessage = document.querySelector(".message.success");
        if (successMessage) {
            console.log("✅ Success message detected! Redirecting in 30 seconds...");

            setTimeout(function () {
                window.location.href = "{% url 'scrapchef:login_view' %}";
            }, 30000); // 30 seconds delay

            // Optional: Hide message after a few seconds before redirect
            setTimeout(function () {
                successMessage.style.transition = "opacity 1s";
                successMessage.style.opacity = "0";
            }, 25000);
        } else {
            console.log("❌ No success message found. Not redirecting.");
        }
    });
</script>

{% endblock %}
z
